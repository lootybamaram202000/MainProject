# 📏 سیستم مدیریت واحدهای اندازه‌گیری (Units Management)

## نمای کلی

سیستم مدیریت واحدهای اندازه‌گیری بخشی از پروژه MainProject است که امکان تعریف، ویرایش و مدیریت واحدهای اندازه‌گیری را برای محصولات خریداری شده و تولیدی فراهم می‌کند.

## مفاهیم کلیدی

### واحد اندازه‌گیری پایه (Base Measurement Unit)
- واحد کوچکتر با مقدار عددی بیشتر
- مثال: **1000 گرم**

### واحد کاربردی (Practical Unit)
- واحد بزرگتر با مقدار عددی کمتر
- مثال: **1 کیلوگرم**

### نسبت تبدیل
1000 گرم = 1 کیلوگرم
نسبت: 1000:1

## انواع واحدها

### 1. واحد خرید (Purchase)
برای محصولاتی که از فروشندگان خریداری می‌شوند.
- کد: MU + 8 رقم
- مثال: برنج، روغن، قند

### 2. واحد تولید (Product)
برای محصولاتی که در سیستم تولید می‌شوند.
- کد: PU + 8 رقم
- مثال: پرس پیتزا، فنجان قهوه

## معماری سیستم

```
┌─────────────────────────────────────────────┐
│         UI Layer (SubmitUnitFRM)            │
│  ┌───────────────────────────────────────┐  │
│  │ - ورود اطلاعات                        │  │
│  │ - اعتبارسنجی بصری                     │  │
│  │ - نمایش لیست                          │  │
│  └───────────────────────────────────────┘  │
└─────────────────┬───────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────┐
│      Business Logic (UnitManager)           │
│  ┌───────────────────────────────────────┐  │
│  │ - اعتبارسنجی داده                      │  │
│  │ - منطق کسب‌وکار                        │  │
│  │ - هماهنگی عملیات                       │  │
│  └───────────────────────────────────────┘  │
└─────────────────┬───────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────┐
│      Data Access (UnitDAL)                  │
│  ┌───────────────────────────────────────┐  │
│  │ - ارتباط با دیتابیس                   │  │
│  │ - اجرای SP ها                          │  │
│  │ - مدیریت تراکنش                        │  │
│  └───────────────────────────────────────┘  │
└─────────────────┬───────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────┐
│         Database (tblUnits)                 │
│  - Stored Procedures                        │
│  - Indexes                                  │
│  - Constraints                              │
└─────────────────────────────────────────────┘
```

## ساختار دیتابیس

### جدول tblUnits

| ستون | نوع | توضیحات |
|------|-----|---------|
| UnitID | NVARCHAR(50) | کلید اصلی |
| UnitType | NVARCHAR(50) | Purchase/Product |
| MeasurmentUnitTitle | NVARCHAR(200) | عنوان واحد پایه |
| MesurmentUnitQuantity | INT | مقدار واحد پایه |
| PUnitTitle | NVARCHAR(200) | عنوان واحد کاربردی |
| PUnitQuantity | INT | مقدار واحد کاربردی |
| isActive | BIT | وضعیت فعال/غیرفعال |
| isDeleted | BIT | حذف منطقی |

### Stored Procedures

1. **sp_InsertUnit** - ثبت واحد جدید
2. **sp_UpdateUnit** - به‌روزرسانی واحد
3. **sp_DeleteUnit** - حذف منطقی
4. **sp_ReturnAllUnits** - لیست واحدها
5. **sp_SearchUnits** - جستجو
6. **sp_GenerateNewCode** - تولید کد یکتا

## ویژگی‌های رابط کاربری

### کلیدهای میانبر

| کلید | عملکرد |
|------|---------|
| F2 | ثبت واحد جدید |
| F3 | ویرایش واحد |
| F4 | حذف واحد |
| F5 | رفرش لیست |
| Escape | پاک کردن فرم |
| Enter | رفتن به فیلد بعدی |

### ترتیب Tab

1. مقدار واحد کاربردی (شروع)
2. عنوان واحد کاربردی
3. مقدار واحد پایه
4. عنوان واحد پایه
5. نوع واحد (RadioButton)
6. وضعیت فعال (CheckBox)
7. دکمه‌های عملیات

### اعتبارسنجی

- ✅ عنوان‌ها نباید خالی باشند
- ✅ مقادیر باید عدد مثبت باشند
- ✅ تکراری نبودن ترکیب نوع + عنوان‌ها
- ⚠️ هشدار: مقدار پایه باید بیشتر از کاربردی باشد

## نمونه‌های کاربردی

### مثال 1: واحد خرید برنج
```
نوع: Purchase
واحد پایه: گرم (1000)
واحد کاربردی: کیلوگرم (1)
کد: MU00000001
```

### مثال 2: واحد تولید پیتزا
```
نوع: Product
واحد پایه: عدد (1)
واحد کاربردی: پرس (1)
کد: PU00000001
```

### مثال 3: واحد خرید روغن
```
نوع: Purchase
واحد پایه: میلی‌لیتر (1000)
واحد کاربردی: لیتر (1)
کد: MU00000002
```

## استفاده در سایر بخش‌ها

واحدها در بخش‌های زیر استفاده می‌شوند:
- ✅ مدیریت محصولات (Products)
- ✅ تعریف آیتم‌های پایه (Basic Items)
- ✅ رسیپی منو (Menu Recipes)
- ✅ گزارش‌گیری موجودی

## نکات فنی

### مشکل شناخته شده: Typo در نام فیلدها
نام فیلدهای `MeasurmentUnitTitle` و `MesurmentUnitQuantity` دارای غلط املایی هستند (باید `Measurement` باشند). به دلیل وابستگی‌های سیستمی، این نام‌ها حفظ شده‌اند.

### بهینه‌سازی‌های انجام شده
- ✅ Index بر روی UnitType و isDeleted
- ✅ Try-Catch در تمام متدهای DAL
- ✅ Validation در لایه BLL
- ✅ ErrorProvider برای بازخورد بصری
- ✅ Soft Delete به جای حذف فیزیکی

## توسعه آینده

پیشنهادات برای بهبود:
1. 🔄 Migration برای رفع Typo در نام فیلدها
2. 📊 نمودار مصرف واحدها در گزارش‌ها
3. 🔍 فیلتر پیشرفته بر اساس نوع
4. 📤 Export/Import واحدها از Excel
5. 🗂️ دسته‌بندی واحدها (وزن، حجم، تعداد)

## مراجع

### فایل‌های کد
- Model: `MainProject/Entities/UnitModel.cs`
- DAL: `MainProject/DataAccess/UnitDAL.cs`
- BLL: `MainProject/Core/Business/UnitManager.cs`
- Form: `MainProject/Forms/SubmitUnitFRM.cs`

---

📅 آخرین به‌روزرسانی: 1404/09/27
👤 نگهدارنده: Development Team