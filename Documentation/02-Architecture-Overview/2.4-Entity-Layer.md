# 2.4 لایه موجودیت (Entity Layer)

## 📋 فهرست مطالب
- [معرفی](#معرفی)
- [مسئولیت‌ها](#مسئولیتها)
- [ساختار Model Classes](#ساختار-model-classes)
- [انواع Models](#انواع-models)
- [بهترین شیوه‌ها](#بهترین-شیوهها)

---

## معرفی

### 🎯 تعریف
لایه Entity شامل تمام کلاس‌های مدل (POCO - Plain Old CLR Object) است که برای انتقال داده بین لایه‌ها استفاده می‌شوند.

### 📁 مسیر
```
MainProject/Entities/
```

### 📊 آمار
- **تعداد Model Classes**: ~16 کلاس
- **الگوی نام‌گذاری**: `[Entity]Model.cs`

---

## مسئولیت‌ها

### ✅ مسئولیت‌های اصلی

#### 1. نمایش داده (Data Representation)
- نمایش ساختار جداول
- نمایش ViewModels
- نمایش DTOs

#### 2. انتقال داده (Data Transfer)
- انتقال بین لایه‌ها
- Serialization/Deserialization
- Data Binding

#### 3. اعتبارسنجی ساختاری (Structural Validation)
- Data Annotations
- Property Constraints
- Type Safety

---

## ساختار Model Classes

### 🏗️ ساختار استاندارد

```csharp
public class ExampleModel
{
    // 1. Primary Key
    public int ExampleID { get; set; }
    
    // 2. Basic Properties
    public string Name { get; set; }
    public string Description { get; set; }
    public decimal Price { get; set; }
    public int Quantity { get; set; }
    
    // 3. Foreign Keys
    public int CategoryID { get; set; }
    public int UserID { get; set; }
    
    // 4. Status & Flags
    public bool IsActive { get; set; }
    public bool IsDeleted { get; set; }
    
    // 5. Audit Fields
    public DateTime CreatedDate { get; set; }
    public int CreatedBy { get; set; }
    public DateTime? ModifiedDate { get; set; }
    public int? ModifiedBy { get; set; }
    
    // 6. Navigation Properties (Optional)
    public CategoryModel Category { get; set; }
    public UserModel User { get; set; }
    
    // 7. Computed Properties (Optional)
    public decimal TotalPrice => Price * Quantity;
    public string DisplayName => $"{Name} ({Code})";
}
```

---

## انواع Models

### 1️⃣ Domain Models

**هدف**: نمایش جداول اصلی دیتابیس

#### ItemModel
```csharp
public class ItemModel
{
    public int ItemID { get; set; }
    public string ItemName { get; set; }
    public int UnitID { get; set; }
    public decimal UnitPrice { get; set; }
    public int Quantity { get; set; }
    public bool IsActive { get; set; }
    public DateTime CreatedDate { get; set; }
}
```

#### ProductModel
```csharp
public class ProductModel
{
    public int ProductID { get; set; }
    public string ProductName { get; set; }
    public int SectionID { get; set; }
    public decimal SalePrice { get; set; }
    public string Description { get; set; }
    public bool IsAvailable { get; set; }
    public decimal CostPrice { get; set; }
}
```

#### FactorModel
```csharp
public class FactorModel
{
    public int FactorID { get; set; }
    public string FactorNumber { get; set; }
    public DateTime FactorDate { get; set; }
    public int CustomerID { get; set; }
    public decimal TotalAmount { get; set; }
    public decimal Discount { get; set; }
    public decimal FinalAmount { get; set; }
    public bool IsPaid { get; set; }
}
```

#### AccountModel
```csharp
public class AccountModel
{
    public int AccountID { get; set; }
    public string AccountNumber { get; set; }
    public string AccountName { get; set; }
    public string BankName { get; set; }
    public decimal Balance { get; set; }
    public bool IsActive { get; set; }
}
```

---

### 2️⃣ DTO Models

**هدف**: انتقال داده‌های ترکیبی یا View-Specific

#### InformationDto
```csharp
public class InformationDto
{
    public int ID { get; set; }
    public string Title { get; set; }
    public string Value { get; set; }
    public string Type { get; set; }
}
```

---

### 3️⃣ Composite Models

**هدف**: ترکیب چند Entity

#### BasicRecipieModel
```csharp
public class BasicRecipieModel
{
    public int RecipeID { get; set; }
    public int ProductID { get; set; }
    public int ItemID { get; set; }
    public decimal Quantity { get; set; }
    public int UnitID { get; set; }
}
```

#### ItemRecipieModel
```csharp
public class ItemRecipieModel
{
    public int RecipeID { get; set; }
    public int ParentItemID { get; set; }
    public int ChildItemID { get; set; }
    public decimal Quantity { get; set; }
}
```

---

### 4️⃣ Sub Models

**هدف**: آیتم‌های زیرمجموعه

#### SubFactorModel
```csharp
public class SubFactorModel
{
    public int SubFactorID { get; set; }
    public int FactorID { get; set; }
    public int ProductID { get; set; }
    public int Quantity { get; set; }
    public decimal UnitPrice { get; set; }
    public decimal TotalPrice { get; set; }
    public decimal Discount { get; set; }
}
```

---

### 5️⃣ Lookup Models

**هدف**: جداول کمکی و Lookup

#### UnitModel
```csharp
public class UnitModel
{
    public int UnitID { get; set; }
    public string UnitName { get; set; }
    public string Symbol { get; set; }
    public bool IsActive { get; set; }
}
```

#### SectionModel
```csharp
public class SectionModel
{
    public int SectionID { get; set; }
    public string SectionName { get; set; }
    public string Description { get; set; }
    public bool IsActive { get; set; }
}
```

---

### 6️⃣ Authentication Models

#### LoginModel
```csharp
public class LoginModel
{
    public string Username { get; set; }
    public string Password { get; set; }
    public bool RememberMe { get; set; }
}
```

---

### 7️⃣ Information Models

#### MainMenuInfo
```csharp
public class MainMenuInfo
{
    public int MenuID { get; set; }
    public string MenuName { get; set; }
    public int ParentID { get; set; }
    public string Icon { get; set; }
}
```

---

## Model Classes موجود

### لیست کامل
1. **ItemModel** - اقلام پایه
2. **ProductModel** - محصولات نهایی
3. **FactorModel** - فاکتور اصلی
4. **SubFactorModel** - آیتم‌های فاکتور
5. **AccountModel** - حساب بانکی
6. **OverHeadModel** - هزینه‌ها
7. **SellerModel** - فروشندگان
8. **UnitModel** - واحدها
9. **SectionModel** - بخش‌ها
10. **BasicItemModel** - اقلام پایه تکمیلی
11. **BasicRecipieModel** - دستور پخت پایه
12. **ItemRecipieModel** - دستور پخت اقلام
13. **LoginModel** - ورود کاربر
14. **InformationDto** - اطلاعات عمومی
15. **InformationModel** - مدل اطلاعات
16. **MainMenuInfo** - منوی اصلی

---

## بهترین شیوه‌ها

### ✅ DO (انجام دهید)

#### 1. استفاده از Properties
```csharp
// ✅ صحیح - Properties
public class ProductModel
{
    public int ProductID { get; set; }
    public string Name { get; set; }
}
```

#### 2. استفاده از Nullable برای Optional Fields
```csharp
public class ExampleModel
{
    public int ID { get; set; }
    public DateTime? ModifiedDate { get; set; } // Nullable
    public int? ModifiedBy { get; set; } // Nullable
}
```

#### 3. استفاده از Computed Properties
```csharp
public class FactorModel
{
    public decimal TotalAmount { get; set; }
    public decimal Discount { get; set; }
    
    // Computed Property
    public decimal FinalAmount => TotalAmount - Discount;
}
```

#### 4. استفاده از Data Annotations (اختیاری)
```csharp
using System.ComponentModel.DataAnnotations;

public class ProductModel
{
    [Required(ErrorMessage = "نام محصول الزامی است")]
    [StringLength(100)]
    public string ProductName { get; set; }
    
    [Range(0, 999999999)]
    public decimal Price { get; set; }
}
```

---

### ❌ DON'T (انجام ندهید)

#### 1. منطق کسب‌وکار در Model
```csharp
// ❌ اشتباه - Business Logic در Model
public class ProductModel
{
    public decimal Price { get; set; }
    
    public decimal CalculateDiscount() // نباید!
    {
        return Price * 0.1m;
    }
}

// ✅ صحیح - فقط Properties
public class ProductModel
{
    public decimal Price { get; set; }
}
```

#### 2. دسترسی به Database در Model
```csharp
// ❌ اشتباه - Database Access در Model
public class ProductModel
{
    public void Save() // نباید!
    {
        // Database code
    }
}
```

#### 3. استفاده از Fields به جای Properties
```csharp
// ❌ اشتباه - Fields
public class ProductModel
{
    public int ProductID; // نباید
    public string Name; // نباید
}

// ✅ صحیح - Properties
public class ProductModel
{
    public int ProductID { get; set; }
    public string Name { get; set; }
}
```

---

## نکات مهم

### 📦 POCO Classes
- Model ها باید POCO (Plain Old CLR Object) باشند
- بدون وابستگی به Framework
- بدون منطق کسب‌وکار
- فقط Properties و Fields

### 🔄 Immutability (اختیاری)
```csharp
// برای Models که نباید تغییر کنند
public class ImmutableModel
{
    public int ID { get; }
    public string Name { get; }
    
    public ImmutableModel(int id, string name)
    {
        ID = id;
        Name = name;
    }
}
```

### 📝 Documentation
```csharp
/// <summary>
/// مدل محصول - نمایش اطلاعات محصولات نهایی
/// </summary>
public class ProductModel
{
    /// <summary>
    /// شناسه یکتای محصول
    /// </summary>
    public int ProductID { get; set; }
    
    /// <summary>
    /// نام محصول - حداکثر 100 کاراکتر
    /// </summary>
    public string ProductName { get; set; }
}
```

---

## 📅 تاریخچه تغییرات

### 2025-12-17
- ایجاد اولیه مستند Entity Layer
- توضیح Model Classes
- انواع Models

---

## Metadata (برای AI)

```json
{
  "document_type": "layer_documentation",
  "layer": "entity",
  "layer_name": "Entity Layer",
  "pattern": "POCO / DTO",
  "language": "Persian (Farsi)",
  "models_count": 16,
  "last_updated": "2025-12-17"
}
```
